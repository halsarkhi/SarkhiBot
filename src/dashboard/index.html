<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KERNEL // Command Center</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Share+Tech+Mono&family=Rajdhani:wght@300;400;500;600;700&display=swap');

  :root {
    --bg: #05080c;
    --bg2: #080e18;
    --panel-bg: rgba(8,14,24,0.92);
    --panel-border: rgba(57,255,20,0.10);
    --panel-border-hover: rgba(57,255,20,0.30);
    --accent: #39ff14;
    --accent-dim: rgba(57,255,20,0.45);
    --accent-bg: rgba(57,255,20,0.04);
    --accent-bg2: rgba(57,255,20,0.08);
    --amber: #ffb000;
    --red: #ff3333;
    --magenta: #ff00ff;
    --blue: #4488ff;
    --dim: #3a5068;
    --text: #8fa8bc;
    --text-bright: #d0e0f0;
    --sidebar-w: 56px;
    --topbar-h: 42px;
    --rightbar-w: 52px;
    --font-hud: 'Orbitron', 'Share Tech Mono', monospace;
    --font-mono: 'Share Tech Mono', 'Fira Code', monospace;
    --font-ui: 'Rajdhani', 'Share Tech Mono', sans-serif;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font-mono);
    font-size: 12px;
    line-height: 1.5;
    overflow-x: hidden;
    min-height: 100vh;
  }

  /* ═══════ PARTICLE NETWORK CANVAS ═══════ */
  #particle-canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 0;
    pointer-events: none;
  }

  /* ═══════ SCANLINES ═══════ */
  .scanlines {
    position: fixed; inset: 0;
    background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.04) 2px, rgba(0,0,0,0.04) 4px);
    pointer-events: none;
    z-index: 9999;
  }

  /* ═══════ SIDEBAR ═══════ */
  .sidebar {
    position: fixed;
    top: 0; left: 0; bottom: 0;
    width: var(--sidebar-w);
    background: var(--bg2);
    border-right: 1px solid var(--panel-border);
    z-index: 100;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 12px 0;
    gap: 2px;
  }

  .sidebar-logo {
    width: 32px; height: 32px;
    margin-bottom: 12px;
    position: relative;
  }
  .sidebar-logo svg { width: 100%; height: 100%; }

  .sidebar-nav {
    display: flex;
    flex-direction: column;
    gap: 2px;
    width: 100%;
    flex: 1;
  }

  .nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 8px 0;
    cursor: pointer;
    position: relative;
    color: var(--dim);
    transition: color 0.2s;
    text-decoration: none;
  }
  .nav-item:hover, .nav-item.active { color: var(--accent); }
  .nav-item.active::before {
    content: '';
    position: absolute;
    left: 0; top: 4px; bottom: 4px;
    width: 2px;
    background: var(--accent);
    box-shadow: 0 0 8px var(--accent);
  }
  .nav-item svg { width: 18px; height: 18px; stroke: currentColor; fill: none; stroke-width: 1.5; stroke-linecap: round; stroke-linejoin: round; }
  .nav-label { font-family: var(--font-hud); font-size: 7px; letter-spacing: 1px; margin-top: 3px; }

  /* Sidebar gauges */
  .sidebar-gauges {
    margin-top: auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding-bottom: 8px;
  }
  .mini-gauge { position: relative; width: 38px; height: 38px; }
  .mini-gauge svg { width: 100%; height: 100%; transform: rotate(-90deg); }
  .mini-gauge .track { fill: none; stroke: rgba(57,255,20,0.08); stroke-width: 3; }
  .mini-gauge .fill { fill: none; stroke: var(--accent); stroke-width: 3; stroke-linecap: round; transition: stroke-dashoffset 0.8s ease; }
  .mini-gauge .fill.amber { stroke: var(--amber); }
  .mini-gauge .fill.red { stroke: var(--red); }
  .mini-gauge-label {
    position: absolute; inset: 0;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    font-family: var(--font-hud);
  }
  .mini-gauge-label .val { font-size: 9px; font-weight: 700; color: var(--accent); }
  .mini-gauge-label .lbl { font-size: 6px; color: var(--dim); letter-spacing: 0.5px; }

  .sidebar-clock {
    font-family: var(--font-hud);
    font-size: 8px;
    color: var(--dim);
    letter-spacing: 1px;
    writing-mode: vertical-lr;
    text-orientation: mixed;
    margin-top: 8px;
    padding-bottom: 4px;
  }

  .sidebar-conn {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--red);
    margin-top: 8px;
    transition: all 0.3s;
  }
  .sidebar-conn.connected { background: var(--accent); box-shadow: 0 0 10px var(--accent); }

  /* ═══════ TOP BAR ═══════ */
  .top-bar {
    position: fixed;
    top: 0;
    left: var(--sidebar-w);
    right: 0;
    height: var(--topbar-h);
    background: var(--bg2);
    border-bottom: 1px solid var(--panel-border);
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    font-family: var(--font-hud);
  }
  .top-bar::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, var(--accent), rgba(57,255,20,0.15) 30%, transparent 70%, rgba(57,255,20,0.15) 90%, var(--accent));
  }
  .top-bar-left {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .top-bar-title {
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 3px;
    color: var(--accent);
  }
  .top-bar-sep {
    color: rgba(57,255,20,0.2);
    font-size: 12px;
    font-weight: 300;
  }
  .top-bar-nav {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-left: 8px;
  }
  .top-bar-nav-item {
    font-family: var(--font-hud);
    font-size: 8px;
    letter-spacing: 1.5px;
    color: var(--dim);
    padding: 4px 8px;
    cursor: pointer;
    transition: color 0.2s, background 0.2s;
    border: 1px solid transparent;
    text-decoration: none;
  }
  .top-bar-nav-item:hover { color: var(--accent); background: var(--accent-bg); }
  .top-bar-nav-item.active { color: var(--accent); border-color: var(--panel-border); background: var(--accent-bg); }
  .top-bar-right {
    display: flex;
    align-items: center;
    gap: 16px;
    font-size: 10px;
    color: var(--dim);
  }
  .top-bar-right .val { color: var(--accent); }
  .top-bar-right .sep { color: rgba(57,255,20,0.15); }
  .top-bar-conn {
    width: 7px; height: 7px;
    border-radius: 50%;
    background: var(--red);
    transition: all 0.3s;
  }
  .top-bar-conn.connected { background: var(--accent); box-shadow: 0 0 8px var(--accent); }

  /* ═══════ RIGHT BAR ═══════ */
  .right-bar {
    position: fixed;
    top: var(--topbar-h);
    right: 0;
    bottom: 0;
    width: var(--rightbar-w);
    background: var(--bg2);
    border-left: 1px solid var(--panel-border);
    z-index: 100;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 14px 0;
    gap: 4px;
  }
  .right-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    padding: 6px 0;
    width: 100%;
    cursor: default;
    transition: background 0.2s;
  }
  .right-stat:hover { background: var(--accent-bg); }
  .right-stat .r-val {
    font-family: var(--font-hud);
    font-size: 13px;
    font-weight: 700;
    color: var(--accent);
    line-height: 1;
  }
  .right-stat .r-val.zero { color: var(--dim); }
  .right-stat .r-val.warn { color: var(--amber); }
  .right-stat .r-lbl {
    font-family: var(--font-hud);
    font-size: 6px;
    color: var(--dim);
    letter-spacing: 1px;
  }
  .right-stat .r-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    margin: 2px 0;
  }
  .r-dot.on { background: var(--accent); box-shadow: 0 0 8px var(--accent); }
  .r-dot.paused { background: var(--amber); box-shadow: 0 0 8px var(--amber); animation: blink 2s ease-in-out infinite; }
  .r-dot.off { background: var(--dim); }
  .right-divider {
    width: 28px;
    height: 1px;
    background: var(--panel-border);
    margin: 4px 0;
  }
  .right-bar-clock {
    margin-top: auto;
    font-family: var(--font-hud);
    font-size: 8px;
    color: var(--dim);
    letter-spacing: 1px;
    writing-mode: vertical-lr;
    text-orientation: mixed;
    padding-bottom: 4px;
  }

  /* ═══════ MAIN CONTENT ═══════ */
  .main {
    margin-left: var(--sidebar-w);
    margin-right: var(--rightbar-w);
    padding-top: var(--topbar-h);
    position: relative;
    z-index: 1;
    min-height: 100vh;
    padding-bottom: 32px;
  }

  /* ═══════ HERO HEADER ═══════ */
  .hero-bar {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 18px 24px;
    border-bottom: 1px solid var(--panel-border);
    overflow: hidden;
    min-height: 70px;
  }
  .hero-bar::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--accent-dim), transparent);
  }


  .hero-pulse {
    position: relative;
    z-index: 2;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 24px;
    flex-wrap: wrap;
  }
  .pulse-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1px;
    min-width: 60px;
  }
  .pulse-label {
    font-family: var(--font-hud);
    font-size: 7px;
    letter-spacing: 2px;
    color: var(--dim);
  }
  .pulse-val {
    font-family: var(--font-hud);
    font-size: 13px;
    font-weight: 700;
    color: var(--accent);
    letter-spacing: 1px;
    text-shadow: 0 0 8px rgba(57,255,20,0.3);
  }
  .pulse-val.idle { color: var(--dim); text-shadow: none; }
  .pulse-val.active { color: var(--accent); animation: pulseGlow 2s ease-in-out infinite; }
  .pulse-val.warn { color: var(--amber); text-shadow: 0 0 8px rgba(255,176,0,0.3); }
  @keyframes pulseGlow {
    0%, 100% { text-shadow: 0 0 4px rgba(57,255,20,0.2); }
    50% { text-shadow: 0 0 12px rgba(57,255,20,0.5); }
  }

  /* Waveform canvas — full hero background */
  #waveform-canvas {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    opacity: 0.25;
    pointer-events: none;
  }


  /* ═══════ GAUGE ROW ═══════ */
  .gauge-row {
    display: flex;
    justify-content: center;
    gap: 24px;
    padding: 20px 24px;
    border-bottom: 1px solid var(--panel-border);
    flex-wrap: wrap;
  }

  .gauge-widget {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
  }
  .gauge-ring { position: relative; width: 90px; height: 90px; }
  .gauge-ring svg { width: 100%; height: 100%; transform: rotate(-90deg); }
  .gauge-ring .track { fill: none; stroke: var(--accent-bg2); stroke-width: 4; }
  .gauge-ring .fill { fill: none; stroke: var(--accent); stroke-width: 4; stroke-linecap: round; transition: stroke-dashoffset 0.8s cubic-bezier(0.22, 1, 0.36, 1); filter: drop-shadow(0 0 4px var(--accent)); }
  .gauge-ring .fill.amber { stroke: var(--amber); filter: drop-shadow(0 0 4px var(--amber)); }
  .gauge-ring .fill.red { stroke: var(--red); filter: drop-shadow(0 0 4px var(--red)); }
  .gauge-center {
    position: absolute; inset: 0;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
  }
  .gauge-center .pct { font-family: var(--font-hud); font-size: 18px; font-weight: 700; color: var(--accent); }
  .gauge-center .pct.amber { color: var(--amber); }
  .gauge-center .pct.red { color: var(--red); }
  .gauge-center .sub { font-family: var(--font-mono); font-size: 8px; color: var(--dim); }
  .gauge-label { font-family: var(--font-hud); font-size: 8px; letter-spacing: 2px; color: var(--dim); }

  /* ═══════ CONTENT AREA ═══════ */
  .content {
    padding: 12px;
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 10px;
  }

  .span-8 { grid-column: span 8; }
  .span-6 { grid-column: span 6; }
  .span-4 { grid-column: span 4; }
  .span-3 { grid-column: span 3; }
  .span-12 { grid-column: span 12; }

  /* ═══════ PANEL ═══════ */
  .panel {
    position: relative;
    background: var(--panel-bg);
    border: 1px solid var(--panel-border);
    overflow: hidden;
    transition: border-color 0.3s, box-shadow 0.3s;
  }
  .panel:hover {
    border-color: var(--panel-border-hover);
    box-shadow: 0 0 20px rgba(57,255,20,0.04), inset 0 0 20px rgba(57,255,20,0.01);
  }

  /* Corner clips */
  .panel::before {
    content: '';
    position: absolute;
    top: 0; right: 0;
    border-style: solid;
    border-width: 0 14px 14px 0;
    border-color: transparent var(--bg) transparent transparent;
    z-index: 5;
  }
  .panel::after {
    content: '';
    position: absolute;
    top: 0; right: 14px;
    width: 0; height: 14px;
    border-right: 1px solid var(--panel-border);
    transform: rotate(45deg);
    transform-origin: top right;
    z-index: 4;
    pointer-events: none;
  }

  .panel-header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    background: linear-gradient(90deg, var(--accent-bg), transparent 70%);
    border-bottom: 1px solid var(--panel-border);
    font-family: var(--font-hud);
    font-size: 9px;
    font-weight: 600;
    letter-spacing: 2px;
    color: var(--accent);
    text-transform: uppercase;
    user-select: none;
    position: relative;
  }
  .panel-header::after {
    content: '';
    position: absolute;
    bottom: -1px; left: 0;
    width: 50px; height: 1px;
    background: var(--accent);
    box-shadow: 0 0 6px var(--accent);
  }

  .panel-header .dot {
    width: 4px; height: 4px;
    border-radius: 50%;
    background: var(--accent);
    box-shadow: 0 0 6px var(--accent);
    animation: blink 3s ease-in-out infinite;
  }
  @keyframes blink {
    0%, 100% { opacity: 0.4; }
    50% { opacity: 1; }
  }

  .panel-header .tag {
    margin-left: auto;
    font-family: var(--font-mono);
    font-size: 8px;
    color: var(--dim);
    letter-spacing: 1px;
    font-weight: 400;
  }

  .panel-body {
    padding: 10px 12px;
    max-height: 300px;
    overflow-y: auto;
  }
  .panel-body.tall { max-height: 400px; }
  .panel-body.short { max-height: 200px; }

  .panel-body::-webkit-scrollbar { width: 3px; }
  .panel-body::-webkit-scrollbar-track { background: transparent; }
  .panel-body::-webkit-scrollbar-thumb { background: var(--accent-dim); border-radius: 2px; }

  /* Scan sweep inside panels */
  .panel .sweep {
    position: absolute;
    left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(57,255,20,0.06), transparent);
    animation: sweepDown 10s linear infinite;
    pointer-events: none;
    z-index: 3;
  }
  @keyframes sweepDown {
    0% { top: 0; opacity: 0; }
    5% { opacity: 1; }
    95% { opacity: 1; }
    100% { top: 100%; opacity: 0; }
  }

  /* ═══════ DATA ELEMENTS ═══════ */
  .row { display: flex; justify-content: space-between; padding: 3px 0; border-bottom: 1px solid rgba(57,255,20,0.03); }
  .row:last-child { border-bottom: none; }
  .row .k { color: var(--dim); font-size: 11px; }
  .row .v { color: var(--accent); text-align: right; font-size: 11px; }

  .bar-track {
    height: 5px;
    background: var(--accent-bg);
    margin: 3px 0;
    overflow: hidden;
  }
  .bar-fill {
    height: 100%;
    transition: width 0.6s cubic-bezier(0.22, 1, 0.36, 1);
  }
  .bar-fill.green { background: linear-gradient(90deg, rgba(57,255,20,0.2), var(--accent)); }
  .bar-fill.amber { background: linear-gradient(90deg, rgba(255,176,0,0.2), var(--amber)); }
  .bar-fill.red { background: linear-gradient(90deg, rgba(255,51,51,0.2), var(--red)); }

  .badge {
    display: inline-block;
    padding: 1px 6px;
    font-family: var(--font-hud);
    font-size: 8px;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
    border: 1px solid;
  }
  .badge.running { border-color: rgba(57,255,20,0.3); color: var(--accent); animation: pulseB 2s infinite; }
  .badge.completed { border-color: rgba(57,255,20,0.2); color: var(--accent); }
  .badge.failed { border-color: rgba(255,51,51,0.2); color: var(--red); }
  .badge.cancelled { border-color: rgba(255,176,0,0.2); color: var(--amber); }
  .badge.queued { border-color: rgba(58,74,90,0.3); color: var(--dim); }
  @keyframes pulseB { 0%,100% { box-shadow: 0 0 2px rgba(57,255,20,0.1); } 50% { box-shadow: 0 0 10px rgba(57,255,20,0.3); } }

  .job-row { padding: 5px 0; border-bottom: 1px solid rgba(57,255,20,0.03); border-left: 2px solid transparent; padding-left: 6px; transition: border-color 0.2s; }
  .job-row:hover { border-left-color: var(--accent-dim); }
  .job-row:last-child { border-bottom: none; }
  .job-meta { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
  .job-id { color: var(--amber); font-weight: 600; font-family: var(--font-hud); font-size: 9px; letter-spacing: 1px; }
  .job-type { color: var(--magenta); }
  .job-task { color: var(--text); font-size: 11px; margin-top: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .job-sub { color: var(--dim); font-size: 10px; margin-top: 1px; }

  .log-line { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding: 1px 0; font-size: 11px; }
  .log-line .ts { color: var(--dim); }
  .log-line .lvl-error { color: var(--red); font-weight: 700; }
  .log-line .lvl-warn { color: var(--amber); }
  .log-line .lvl-info { color: var(--accent); }
  .log-line .lvl-debug { color: var(--dim); }
  .log-line .msg { color: var(--text); }

  .mem-item { padding: 3px 0; border-bottom: 1px solid rgba(57,255,20,0.03); }
  .mem-item:last-child { border-bottom: none; }
  .mem-time { color: var(--dim); font-size: 9px; }
  .mem-type { font-family: var(--font-hud); font-size: 8px; font-weight: 600; letter-spacing: 1px; }
  .mem-type.interaction { color: var(--accent); }
  .mem-type.thought { color: var(--magenta); }
  .mem-type.discovery { color: var(--amber); }
  .mem-type.creation { color: var(--accent); }
  .mem-summary { color: var(--text); font-size: 11px; }

  .share-item { padding: 3px 0; border-bottom: 1px solid rgba(57,255,20,0.03); }
  .share-pri.high { color: var(--accent); }
  .share-pri.medium { color: var(--accent); }
  .share-pri.low { color: var(--dim); }

  .char-active { color: var(--accent); font-size: 13px; font-family: var(--font-ui); font-weight: 600; margin-bottom: 4px; }
  .char-item { color: var(--dim); font-size: 11px; padding: 1px 0; }
  .char-item.active { color: var(--accent); }

  .conv-item { padding: 2px 0; display: flex; justify-content: space-between; border-bottom: 1px solid rgba(57,255,20,0.03); }
  .conv-item .chat-id { color: var(--accent); font-family: var(--font-mono); }
  .conv-item .chat-id.life { color: var(--magenta); }

  .auto-item { padding: 4px 0; border-bottom: 1px solid rgba(57,255,20,0.03); }
  .auto-name { color: var(--accent); font-weight: 600; font-family: var(--font-hud); font-size: 9px; letter-spacing: 1px; }
  .auto-detail { color: var(--dim); font-size: 10px; }

  .md-content { white-space: pre-wrap; word-wrap: break-word; color: var(--text); font-size: 11px; }
  .md-content .ts-line { color: var(--accent); }

  /* Evolution ring chart */
  .evo-ring-row { display: flex; align-items: center; gap: 16px; margin-bottom: 8px; }
  .evo-ring { position: relative; width: 80px; height: 80px; flex-shrink: 0; }
  .evo-ring svg { width: 100%; height: 100%; transform: rotate(-90deg); }
  .evo-ring .track { fill: none; stroke: var(--accent-bg2); stroke-width: 6; }
  .evo-ring-center {
    position: absolute; inset: 0;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
  }
  .evo-ring-center .pct { font-family: var(--font-hud); font-size: 16px; font-weight: 700; color: var(--accent); }
  .evo-ring-center .lbl { font-family: var(--font-hud); font-size: 6px; color: var(--dim); letter-spacing: 1px; }
  .evo-legend { display: flex; flex-direction: column; gap: 3px; }
  .evo-legend-item { display: flex; align-items: center; gap: 6px; font-size: 10px; }
  .evo-legend-dot { width: 6px; height: 6px; border-radius: 50%; }

  .evo-proposal { padding: 4px 0; border-bottom: 1px solid rgba(57,255,20,0.03); }

  /* Life engine */
  .activity-bar { display: flex; align-items: center; gap: 6px; padding: 2px 0; }
  .activity-bar .name { width: 70px; text-align: right; color: var(--dim); font-family: var(--font-hud); font-size: 8px; letter-spacing: 0.5px; }
  .activity-bar .bar { flex: 1; height: 5px; background: var(--accent-bg); overflow: hidden; }
  .activity-bar .fill { height: 100%; background: linear-gradient(90deg, rgba(57,255,20,0.2), var(--accent)); transition: width 0.6s ease; }
  .activity-bar .count { width: 26px; color: var(--accent); font-size: 10px; font-family: var(--font-hud); }

  .empty-msg { color: var(--dim); font-style: italic; text-align: center; padding: 20px 0; font-size: 11px; letter-spacing: 1px; }

  .life-status { font-family: var(--font-hud); font-size: 13px; font-weight: 700; letter-spacing: 3px; margin-bottom: 6px; }
  .life-status.active { color: var(--accent); text-shadow: 0 0 12px rgba(57,255,20,0.3); }
  .life-status.paused { color: var(--amber); }
  .life-status.idle { color: var(--dim); }

  /* ═══════ INTEGRATION STATUS BAR ═══════ */
  .integrations-bar {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    padding: 8px 24px;
    border-bottom: 1px solid var(--panel-border);
    flex-wrap: wrap;
  }
  .integ-item {
    display: flex;
    align-items: center;
    gap: 5px;
    font-family: var(--font-hud);
    font-size: 8px;
    letter-spacing: 1px;
    color: var(--dim);
  }
  .integ-dot {
    width: 5px; height: 5px;
    border-radius: 50%;
    background: var(--dim);
  }
  .integ-dot.on { background: var(--accent); box-shadow: 0 0 6px var(--accent); }
  .integ-dot.off { background: rgba(255,51,51,0.5); }

  /* ═══════ EXPANDABLE JOB DETAIL ═══════ */
  .job-row { cursor: pointer; }
  .job-detail {
    display: none;
    margin-top: 4px;
    padding: 6px 8px;
    background: rgba(57,255,20,0.02);
    border: 1px solid rgba(57,255,20,0.06);
    border-radius: 2px;
  }
  .job-detail.open { display: block; }
  .job-detail-section { margin-bottom: 4px; }
  .job-detail-label {
    font-family: var(--font-hud);
    font-size: 7px;
    letter-spacing: 1.5px;
    color: var(--dim);
    margin-bottom: 1px;
  }
  .job-detail-val { color: var(--text); font-size: 10px; line-height: 1.4; }
  .job-detail-val.error { color: var(--red); }
  .job-detail-val .tool-tag {
    display: inline-block;
    padding: 0 4px;
    margin: 1px 2px;
    border: 1px solid rgba(57,255,20,0.12);
    color: var(--accent);
    font-size: 9px;
    font-family: var(--font-mono);
  }
  .job-detail-val .artifact-tag {
    display: inline-block;
    padding: 0 4px;
    margin: 1px 2px;
    border: 1px solid rgba(255,176,0,0.2);
    color: var(--amber);
    font-size: 9px;
  }
  .job-progress-timeline {
    max-height: 100px;
    overflow-y: auto;
    font-size: 10px;
    color: var(--dim);
    line-height: 1.5;
  }
  .job-progress-timeline::-webkit-scrollbar { width: 2px; }
  .job-progress-timeline::-webkit-scrollbar-thumb { background: var(--accent-dim); }

  /* ═══════ WORKER CARDS (Capabilities) ═══════ */
  .worker-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 6px;
  }
  .worker-card {
    padding: 6px 8px;
    border: 1px solid rgba(57,255,20,0.06);
    background: rgba(57,255,20,0.02);
    transition: border-color 0.2s;
  }
  .worker-card:hover { border-color: rgba(57,255,20,0.2); }
  .worker-card-head {
    display: flex;
    align-items: center;
    gap: 5px;
    margin-bottom: 3px;
  }
  .worker-emoji { font-size: 14px; }
  .worker-name {
    font-family: var(--font-hud);
    font-size: 8px;
    letter-spacing: 1px;
    color: var(--accent);
    font-weight: 600;
  }
  .worker-desc { font-size: 10px; color: var(--text); margin-bottom: 3px; }
  .worker-meta {
    display: flex;
    gap: 8px;
    font-size: 9px;
    color: var(--dim);
  }
  .worker-meta .v { color: var(--accent); }

  /* ═══════ KNOWLEDGE ITEMS ═══════ */
  .knowledge-item {
    padding: 4px 0;
    border-bottom: 1px solid rgba(57,255,20,0.03);
  }
  .knowledge-item:last-child { border-bottom: none; }
  .knowledge-topic {
    font-family: var(--font-hud);
    font-size: 9px;
    letter-spacing: 1px;
    color: var(--accent);
    font-weight: 600;
  }
  .knowledge-summary { font-size: 10px; color: var(--text); margin-top: 1px; }
  .knowledge-related { font-size: 9px; color: var(--dim); margin-top: 1px; }

  /* ═══════ IDEAS ITEMS ═══════ */
  .idea-item {
    padding: 3px 0;
    border-bottom: 1px solid rgba(57,255,20,0.03);
    font-size: 10px;
    color: var(--text);
  }
  .idea-item:last-child { border-bottom: none; }
  .idea-item .improve-tag {
    font-family: var(--font-hud);
    font-size: 7px;
    letter-spacing: 1px;
    color: var(--amber);
    margin-right: 4px;
  }
  .idea-time { font-size: 9px; color: var(--dim); margin-left: 4px; }

  /* ═══════ LESSONS ═══════ */
  .lesson-item {
    padding: 4px 0;
    border-bottom: 1px solid rgba(57,255,20,0.03);
  }
  .lesson-item:last-child { border-bottom: none; }
  .lesson-cat {
    display: inline-block;
    padding: 0 4px;
    font-family: var(--font-hud);
    font-size: 7px;
    letter-spacing: 1px;
    color: var(--magenta);
    border: 1px solid rgba(255,0,255,0.15);
    margin-right: 4px;
  }
  .lesson-text { font-size: 10px; color: var(--text); }
  .lesson-importance {
    font-family: var(--font-hud);
    font-size: 8px;
    color: var(--dim);
    margin-left: 4px;
  }

  /* ═══════ COOLDOWN BARS ═══════ */
  .cooldown-row {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 2px 0;
  }
  .cooldown-label {
    width: 75px;
    text-align: right;
    font-family: var(--font-hud);
    font-size: 8px;
    letter-spacing: 0.5px;
    color: var(--dim);
  }
  .cooldown-bar-track {
    flex: 1;
    height: 4px;
    background: var(--accent-bg);
    overflow: hidden;
  }
  .cooldown-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), rgba(57,255,20,0.3));
    transition: width 0.8s ease;
  }
  .cooldown-fill.ready { background: rgba(57,255,20,0.15); }
  .cooldown-time {
    width: 32px;
    font-size: 9px;
    color: var(--accent);
    font-family: var(--font-hud);
  }

  /* ═══════ PANEL TABS ═══════ */
  .panel-tabs {
    display: flex;
    gap: 1px;
    padding: 0 12px;
    margin: -1px 0 4px 0;
    background: rgba(57,255,20,0.02);
    border-bottom: 1px solid rgba(57,255,20,0.05);
  }
  .panel-tab {
    padding: 3px 8px;
    font-family: var(--font-hud);
    font-size: 7px;
    letter-spacing: 1px;
    color: var(--dim);
    cursor: pointer;
    border-bottom: 1px solid transparent;
    transition: color 0.2s, border-color 0.2s;
  }
  .panel-tab:hover { color: var(--text); }
  .panel-tab.active { color: var(--accent); border-bottom-color: var(--accent); }

  /* ═══════ MEMORY TAGS + IMPORTANCE ═══════ */
  .mem-tags { margin-top: 1px; }
  .mem-tag {
    display: inline-block;
    padding: 0 3px;
    margin-right: 2px;
    font-size: 8px;
    color: var(--dim);
    border: 1px solid rgba(57,255,20,0.06);
  }
  .mem-importance {
    float: right;
    font-family: var(--font-hud);
    font-size: 8px;
    color: var(--dim);
  }
  .mem-importance.high { color: var(--accent); }

  /* ═══════ SHARE HISTORY ═══════ */
  .share-shared {
    opacity: 0.6;
    border-left: 2px solid rgba(57,255,20,0.1);
    padding-left: 6px;
  }

  /* ═══════ LOG TICKER (bottom sticky) ═══════ */
  .log-ticker {
    position: fixed;
    bottom: 0;
    left: var(--sidebar-w);
    right: 0;
    height: 28px;
    border-top: 1px solid var(--panel-border);
    background: rgba(5,8,12,0.97);
    overflow: hidden;
    z-index: 101;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }
  .log-ticker .ticker-label {
    position: absolute;
    top: 0; left: 0; bottom: 0;
    width: 80px;
    background: linear-gradient(90deg, var(--bg2) 70%, transparent);
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-hud);
    font-size: 8px;
    letter-spacing: 2px;
    color: var(--accent);
    z-index: 2;
  }
  .log-ticker .ticker-label .dot-pulse {
    width: 5px; height: 5px;
    border-radius: 50%;
    background: var(--accent);
    margin-right: 6px;
    animation: blink 1.5s ease-in-out infinite;
  }
  .ticker-track {
    display: flex;
    animation: tickerScroll var(--ticker-duration, 60s) linear infinite;
    padding: 6px 0 6px 90px;
    white-space: nowrap;
    gap: 40px;
  }
  @keyframes tickerScroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }
  .ticker-item { font-size: 10px; white-space: nowrap; flex-shrink: 0; }
  .ticker-item .ts { color: var(--dim); }
  .ticker-item .lvl-error { color: var(--red); }
  .ticker-item .lvl-warn { color: var(--amber); }
  .ticker-item .lvl-info { color: var(--accent); }
  .ticker-item .lvl-debug { color: var(--dim); }
  .ticker-item .msg { color: var(--text); }

  /* ═══════ RESPONSIVE ═══════ */
  @media (max-width: 1100px) {
    .right-bar { display: none; }
    .main { margin-right: 0; }
    .span-8, .span-6, .span-4, .span-3 { grid-column: span 6; }
    .gauge-ring { width: 72px; height: 72px; }
    .gauge-center .pct { font-size: 14px; }
    .top-bar-nav { display: none; }
  }
  @media (max-width: 768px) {
    .sidebar { display: none; }
    .top-bar { left: 0; }
    .right-bar { display: none; }
    .main { margin-left: 0; margin-right: 0; padding-top: var(--topbar-h); }
    .log-ticker { left: 0; }
    .span-8, .span-6, .span-4, .span-3, .span-12 { grid-column: span 12; }
    .content { grid-template-columns: 1fr; }
    .hero-pulse { gap: 12px; }
    .pulse-stat { min-width: 50px; }
    .pulse-val { font-size: 11px; }
    .gauge-row { gap: 12px; }
    .gauge-ring { width: 64px; height: 64px; }
    .gauge-center .pct { font-size: 12px; }
  }
</style>
</head>
<body>

<canvas id="particle-canvas"></canvas>
<div class="scanlines"></div>

<!-- ═══════ SIDEBAR ═══════ -->
<nav class="sidebar">
  <div class="sidebar-logo">
    <svg viewBox="0 0 32 32" shape-rendering="crispEdges">
      <!-- Pixel-art spiral vortex: 3 rings with rotating gaps -->
      <!-- Outer ring — gap at top-right (1 o'clock) -->
      <path fill="rgba(57,255,20,0.35)" d="M10,2h10v2h-10z M8,4h2v2h-2z M6,6h2v4h-2z M4,10h2v8h-2z M6,18h2v2h-2z M8,20h2v2h-2z M10,22h14v2h-14z M24,18h2v4h-2z M26,8h2v10h-2z M24,6h2v2h-2z"/>
      <!-- Middle ring — gap at bottom-right (4 o'clock) -->
      <path fill="rgba(57,255,20,0.6)" d="M12,8h8v2h-8z M10,10h2v10h-2z M20,10h2v6h-2z M18,18h2v2h-2z M12,20h6v2h-6z"/>
      <!-- Inner core — L-shape spiral hint -->
      <path fill="#39ff14" d="M14,14h4v2h-2v2h-2z"/>
    </svg>
  </div>

  <div class="sidebar-nav">
    <a class="nav-item active" href="#gauges" title="System">
      <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 3"/></svg>
      <span class="nav-label">SYS</span>
    </a>
    <a class="nav-item" href="#p-jobs" title="Jobs">
      <svg viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="5" rx="1"/><rect x="4" y="11" width="16" height="5" rx="1"/></svg>
      <span class="nav-label">JOBS</span>
    </a>
    <a class="nav-item" href="#p-life" title="Life">
      <svg viewBox="0 0 24 24"><path d="M3 12h4l3-9 4 18 3-9h4"/></svg>
      <span class="nav-label">LIFE</span>
    </a>
    <a class="nav-item" href="#p-evo" title="Evolution">
      <svg viewBox="0 0 24 24"><path d="M12 2v4m0 12v4M2 12h4m12 0h4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/></svg>
      <span class="nav-label">EVO</span>
    </a>
    <a class="nav-item" href="#p-mem" title="Memory">
      <svg viewBox="0 0 24 24"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44A2.5 2.5 0 0 1 2 17.5a2.5 2.5 0 0 1 .72-1.76A2.5 2.5 0 0 1 5 12a2.5 2.5 0 0 1-2-4 2.5 2.5 0 0 1 4.5-1.5"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44A2.5 2.5 0 0 0 22 17.5a2.5 2.5 0 0 0-.72-1.76A2.5 2.5 0 0 0 19 12a2.5 2.5 0 0 0 2-4 2.5 2.5 0 0 0-4.5-1.5"/></svg>
      <span class="nav-label">MEM</span>
    </a>
    <a class="nav-item" href="#p-logs" title="Logs">
      <svg viewBox="0 0 24 24"><path d="M4 17l6-6-6-6M12 19h8"/></svg>
      <span class="nav-label">LOGS</span>
    </a>
  </div>

  <!-- Sidebar mini gauges -->
  <div class="sidebar-gauges">
    <div class="mini-gauge" id="sb-cpu">
      <svg viewBox="0 0 38 38"><circle class="track" cx="19" cy="19" r="16"/><circle class="fill" cx="19" cy="19" r="16" stroke-dasharray="100.5" stroke-dashoffset="100.5"/></svg>
      <div class="mini-gauge-label"><span class="val">--%</span><span class="lbl">CPU</span></div>
    </div>
    <div class="mini-gauge" id="sb-ram">
      <svg viewBox="0 0 38 38"><circle class="track" cx="19" cy="19" r="16"/><circle class="fill" cx="19" cy="19" r="16" stroke-dasharray="100.5" stroke-dashoffset="100.5"/></svg>
      <div class="mini-gauge-label"><span class="val">--%</span><span class="lbl">RAM</span></div>
    </div>
    <div class="sidebar-conn connected" id="conn-dot"></div>
  </div>
</nav>

<!-- ═══════ TOP BAR ═══════ -->
<header class="top-bar">
  <div class="top-bar-left">
    <span class="top-bar-title">KernelBot</span>
    <span class="top-bar-sep">//</span>
    <span class="top-bar-nav">
      <a class="top-bar-nav-item active" href="#gauges">SYSTEM</a>
      <a class="top-bar-nav-item" href="#p-jobs">JOBS</a>
      <a class="top-bar-nav-item" href="#p-life">LIFE</a>
      <a class="top-bar-nav-item" href="#p-evo">EVO</a>
      <a class="top-bar-nav-item" href="#p-mem">MEMORY</a>
      <a class="top-bar-nav-item" href="#p-logs">LOGS</a>
    </span>
  </div>
  <div class="top-bar-right">
    <span class="top-bar-conn" id="top-conn"></span>
    <span><span class="val" id="hdr-status">ONLINE</span></span>
    <span class="sep">//</span>
    <span>UP <span class="val" id="hdr-uptime">--</span></span>
    <span class="sep">//</span>
    <span>PID <span class="val" id="hdr-pid">--</span></span>
    <span class="sep">//</span>
    <span>NODE <span class="val" id="hdr-node">--</span></span>
    <span class="sep">//</span>
    <span class="val" id="hdr-clock">--</span>
  </div>
</header>

<!-- ═══════ RIGHT BAR ═══════ -->
<aside class="right-bar">
  <div class="right-stat" title="Running Jobs">
    <span class="r-val zero" id="rb-jobs">0</span>
    <span class="r-lbl">JOBS</span>
  </div>
  <div class="right-divider"></div>
  <div class="right-stat" title="Total Jobs">
    <span class="r-val zero" id="rb-total-jobs">0</span>
    <span class="r-lbl">TOTAL</span>
  </div>
  <div class="right-divider"></div>
  <div class="right-stat" title="Life Engine">
    <span class="r-dot off" id="rb-life-dot"></span>
    <span class="r-lbl">LIFE</span>
  </div>
  <div class="right-divider"></div>
  <div class="right-stat" title="Activities">
    <span class="r-val zero" id="rb-activities">0</span>
    <span class="r-lbl">ACTS</span>
  </div>
  <div class="right-divider"></div>
  <div class="right-stat" title="Memories">
    <span class="r-val zero" id="rb-mem">0</span>
    <span class="r-lbl">MEM</span>
  </div>
  <div class="right-divider"></div>
  <div class="right-stat" title="Share Queue">
    <span class="r-val zero" id="rb-shares">0</span>
    <span class="r-lbl">SHARE</span>
  </div>
  <div class="right-divider"></div>
  <div class="right-stat" title="Evolution Proposals">
    <span class="r-val zero" id="rb-evo">0</span>
    <span class="r-lbl">EVO</span>
  </div>
  <div class="right-divider"></div>
  <div class="right-stat" title="Conversations">
    <span class="r-val zero" id="rb-convs">0</span>
    <span class="r-lbl">CHATS</span>
  </div>
  <div class="right-bar-clock" id="rb-clock">--:--</div>
</aside>

<!-- ═══════ MAIN ═══════ -->
<div class="main">

  <!-- Hero bar -->
  <div class="hero-bar">
    <canvas id="waveform-canvas"></canvas>
    <div class="hero-pulse">
      <div class="pulse-stat">
        <span class="pulse-label">BRAIN</span>
        <span class="pulse-val" id="pulse-brain">--</span>
      </div>
      <div class="pulse-stat">
        <span class="pulse-label">ACTIVITY</span>
        <span class="pulse-val idle" id="pulse-activity">IDLE</span>
      </div>
      <div class="pulse-stat">
        <span class="pulse-label">JOBS</span>
        <span class="pulse-val idle" id="pulse-jobs">0</span>
      </div>
      <div class="pulse-stat">
        <span class="pulse-label">CPU</span>
        <span class="pulse-val" id="pulse-cpu">--%</span>
      </div>
      <div class="pulse-stat">
        <span class="pulse-label">HEAP</span>
        <span class="pulse-val" id="pulse-heap">--</span>
      </div>
      <div class="pulse-stat">
        <span class="pulse-label">UPTIME</span>
        <span class="pulse-val" id="pulse-uptime">--</span>
      </div>
    </div>
  </div>

  <!-- Integration Status Bar -->
  <div class="integrations-bar" id="integrations-bar"></div>

  <!-- Gauge row -->
  <div class="gauge-row" id="gauges">
    <div class="gauge-widget">
      <div class="gauge-ring" id="g-cpu1">
        <svg viewBox="0 0 90 90"><circle class="track" cx="45" cy="45" r="38"/><circle class="fill" cx="45" cy="45" r="38" stroke-dasharray="238.8" stroke-dashoffset="238.8"/></svg>
        <div class="gauge-center"><span class="pct">--%</span><span class="sub">--</span></div>
      </div>
      <div class="gauge-label">CPU 1M</div>
    </div>
    <div class="gauge-widget">
      <div class="gauge-ring" id="g-cpu5">
        <svg viewBox="0 0 90 90"><circle class="track" cx="45" cy="45" r="38"/><circle class="fill" cx="45" cy="45" r="38" stroke-dasharray="238.8" stroke-dashoffset="238.8"/></svg>
        <div class="gauge-center"><span class="pct">--%</span><span class="sub">--</span></div>
      </div>
      <div class="gauge-label">CPU 5M</div>
    </div>
    <div class="gauge-widget">
      <div class="gauge-ring" id="g-ram">
        <svg viewBox="0 0 90 90"><circle class="track" cx="45" cy="45" r="38"/><circle class="fill" cx="45" cy="45" r="38" stroke-dasharray="238.8" stroke-dashoffset="238.8"/></svg>
        <div class="gauge-center"><span class="pct">--%</span><span class="sub">--</span></div>
      </div>
      <div class="gauge-label">RAM</div>
    </div>
    <div class="gauge-widget">
      <div class="gauge-ring" id="g-heap">
        <svg viewBox="0 0 90 90"><circle class="track" cx="45" cy="45" r="38"/><circle class="fill" cx="45" cy="45" r="38" stroke-dasharray="238.8" stroke-dashoffset="238.8"/></svg>
        <div class="gauge-center"><span class="pct">--%</span><span class="sub">--</span></div>
      </div>
      <div class="gauge-label">HEAP</div>
    </div>
  </div>

  <!-- Content grid -->
  <div class="content">

    <!-- ══ TOP ROW: 3 hero panels ══ -->

    <!-- CAPABILITIES -->
    <div class="panel span-4" id="p-caps">
      <div class="sweep"></div>
      <div class="panel-header"><span class="dot"></span>CAPABILITIES<span class="tag" id="caps-tag">WORKERS</span></div>
      <div class="panel-body" id="caps-body"></div>
    </div>

    <!-- LIFE -->
    <div class="panel span-4" id="p-life">
      <div class="sweep"></div>
      <div class="panel-header"><span class="dot"></span>LIFE.ENGINE<span class="tag">AUTONOMOUS</span></div>
      <div class="panel-body" id="life-body"></div>
    </div>

    <!-- MEMORY -->
    <div class="panel span-4" id="p-mem">
      <div class="sweep"></div>
      <div class="panel-header"><span class="dot"></span>MEMORY.BANK<span class="tag" id="mem-tag">EPISODIC</span></div>
      <div class="panel-tabs" id="mem-tabs">
        <span class="panel-tab active" data-tab="episodic">EPISODIC</span>
        <span class="panel-tab" data-tab="knowledge">KNOWLEDGE</span>
      </div>
      <div class="panel-body" id="mem-body"></div>
    </div>

    <!-- ══ SECOND ROW ══ -->

    <!-- JOBS (wide) -->
    <div class="panel span-8" id="p-jobs">
      <div class="sweep"></div>
      <div class="panel-header"><span class="dot"></span>JOBS<span class="tag" id="jobs-count-tag">SWARM // 0</span></div>
      <div class="panel-body" id="jobs-body"></div>
    </div>

    <!-- CONFIG -->
    <div class="panel span-4">
      <div class="sweep"></div>
      <div class="panel-header"><span class="dot"></span>NEURAL.CONFIG<span class="tag">SETTINGS</span></div>
      <div class="panel-body" id="config-body"></div>
    </div>

    <!-- ══ THIRD ROW ══ -->

    <!-- EVOLUTION -->
    <div class="panel span-6" id="p-evo">
      <div class="sweep"></div>
      <div class="panel-header"><span class="dot"></span>EVOLUTION<span class="tag">SELF-IMPROVE</span></div>
      <div class="panel-body" id="evo-body"></div>
    </div>

    <!-- JOURNAL -->
    <div class="panel span-6">
      <div class="sweep"></div>
      <div class="panel-header"><span class="dot"></span>JOURNAL<span class="tag" id="journal-tag">TODAY</span></div>
      <div class="panel-tabs" id="journal-tabs"></div>
      <div class="panel-body" id="journal-body"></div>
    </div>

    <!-- ══ FOURTH ROW ══ -->

    <!-- AUTOMATIONS -->
    <div class="panel span-4">
      <div class="sweep"></div>
      <div class="panel-header"><span class="dot"></span>AUTOMATIONS<span class="tag">SCHEDULER</span></div>
      <div class="panel-body short" id="auto-body"></div>
    </div>

    <!-- IDEAS BACKLOG -->
    <div class="panel span-4" id="p-ideas">
      <div class="sweep"></div>
      <div class="panel-header"><span class="dot"></span>IDEAS.BACKLOG<span class="tag" id="ideas-tag">BRAIN</span></div>
      <div class="panel-body short" id="ideas-body"></div>
    </div>

    <!-- LESSONS -->
    <div class="panel span-4" id="p-lessons">
      <div class="sweep"></div>
      <div class="panel-header"><span class="dot"></span>LESSONS<span class="tag" id="lessons-tag">WISDOM</span></div>
      <div class="panel-body short" id="lessons-body"></div>
    </div>

    <!-- ══ FIFTH ROW ══ -->

    <!-- SHARES -->
    <div class="panel span-4">
      <div class="sweep"></div>
      <div class="panel-header"><span class="dot"></span>SHARE.QUEUE<span class="tag" id="shares-tag">OUTBOUND</span></div>
      <div class="panel-tabs" id="shares-tabs">
        <span class="panel-tab active" data-tab="pending">PENDING</span>
        <span class="panel-tab" data-tab="shared">HISTORY</span>
      </div>
      <div class="panel-body short" id="shares-body"></div>
    </div>

    <!-- CHARACTER -->
    <div class="panel span-4">
      <div class="sweep"></div>
      <div class="panel-header"><span class="dot"></span>CHARACTER<span class="tag">PERSONA</span></div>
      <div class="panel-body short" id="char-body"></div>
    </div>

    <!-- CONVERSATIONS -->
    <div class="panel span-4">
      <div class="sweep"></div>
      <div class="panel-header"><span class="dot"></span>CONVERSATIONS<span class="tag">CHANNELS</span></div>
      <div class="panel-body short" id="conv-body"></div>
    </div>

    <!-- ══ SIXTH ROW ══ -->

    <!-- SELF.AWARENESS -->
    <div class="panel span-6">
      <div class="sweep"></div>
      <div class="panel-header"><span class="dot"></span>SELF.AWARENESS<span class="tag">IDENTITY</span></div>
      <div class="panel-body short" id="self-body"></div>
    </div>

    <!-- SELF.GOALS -->
    <div class="panel span-6">
      <div class="sweep"></div>
      <div class="panel-header"><span class="dot"></span>SELF.GOALS<span class="tag">ASPIRATION</span></div>
      <div class="panel-body short" id="self-goals-body"></div>
    </div>

    <!-- LOG STREAM (full) -->
    <div class="panel span-12" id="p-logs">
      <div class="sweep"></div>
      <div class="panel-header"><span class="dot"></span>LOG.STREAM<span class="tag">REAL-TIME</span></div>
      <div class="panel-body tall" id="logs-body"></div>
    </div>

  </div>


</div>

<!-- Scrolling log ticker (sticky bottom) -->
<div class="log-ticker" id="log-ticker">
  <div class="ticker-label"><span class="dot-pulse"></span>LIVE</div>
  <div class="ticker-track" id="ticker-track"></div>
</div>

<script>
(function() {
  // ── Utilities ──
  function esc(s) {
    if (!s) return '';
    return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }
  function formatDuration(seconds) {
    if (seconds == null || seconds < 0) return '--';
    const s = Math.floor(seconds);
    if (s < 60) return s + 's';
    if (s < 3600) return Math.floor(s/60) + 'm ' + (s%60) + 's';
    return Math.floor(s/3600) + 'h ' + Math.floor((s%3600)/60) + 'm';
  }
  function timeAgo(ts) {
    if (!ts) return 'never';
    const s = Math.floor((Date.now() - ts)/1000);
    if (s < 60) return 'just now';
    if (s < 3600) return Math.floor(s/60) + 'm ago';
    if (s < 86400) return Math.floor(s/3600) + 'h ago';
    return Math.floor(s/86400) + 'd ago';
  }
  function formatBytes(b) {
    if (b < 1024) return b + ' B';
    if (b < 1048576) return (b/1024).toFixed(1) + ' KB';
    if (b < 1073741824) return (b/1048576).toFixed(1) + ' MB';
    return (b/1073741824).toFixed(2) + ' GB';
  }
  function barColor(pct) { return pct < 50 ? 'green' : pct < 80 ? 'amber' : 'red'; }
  function makeBar(label, pct, color) {
    return `<div class="row"><span class="k">${esc(label)}</span><span class="v">${pct.toFixed(1)}%</span></div><div class="bar-track"><div class="bar-fill ${color || barColor(pct)}" style="width:${Math.min(pct,100)}%"></div></div>`;
  }
  const $ = id => document.getElementById(id);

  // ── Clock ──
  setInterval(() => {
    const now = new Date();
    const p = n => String(n).padStart(2,'0');
    const full = now.getFullYear() + '.' + p(now.getMonth()+1) + '.' + p(now.getDate()) + ' ' + p(now.getHours()) + ':' + p(now.getMinutes()) + ':' + p(now.getSeconds());
    $('hdr-clock').textContent = full;
    const rbClock = $('rb-clock');
    if (rbClock) rbClock.textContent = p(now.getHours()) + ':' + p(now.getMinutes());
  }, 1000);

  // ── Gauge helper ──
  function setGauge(id, pct, label) {
    const el = $(id);
    if (!el) return;
    const circumference = parseFloat(el.querySelector('.fill').getAttribute('stroke-dasharray'));
    const offset = circumference * (1 - Math.min(pct, 100) / 100);
    const fill = el.querySelector('.fill');
    fill.style.strokeDashoffset = offset;
    fill.classList.remove('amber', 'red');
    if (pct >= 80) fill.classList.add('red');
    else if (pct >= 50) fill.classList.add('amber');
    const pctEl = el.querySelector('.pct');
    if (pctEl) {
      pctEl.textContent = pct.toFixed(0) + '%';
      pctEl.classList.remove('amber','red');
      if (pct >= 80) pctEl.classList.add('red');
      else if (pct >= 50) pctEl.classList.add('amber');
    }
    const sub = el.querySelector('.sub');
    if (sub && label) sub.textContent = label;
  }

  function setMiniGauge(id, pct) {
    const el = $(id);
    if (!el) return;
    const fill = el.querySelector('.fill');
    const circumference = parseFloat(fill.getAttribute('stroke-dasharray'));
    fill.style.strokeDashoffset = circumference * (1 - Math.min(pct, 100) / 100);
    fill.classList.remove('amber','red');
    if (pct >= 80) fill.classList.add('red');
    else if (pct >= 50) fill.classList.add('amber');
    el.querySelector('.val').textContent = pct.toFixed(0) + '%';
  }

  // ── State ──
  let configData = null, selfData = null;
  let activeMemTab = 'episodic', activeShareTab = 'pending', activeJournalDate = 'today';
  let lastKnowledge = [], lastSharesData = { pending: [], shared: [], todayCount: 0 };
  let lastMemories = [];

  // ── Init fetches ──
  fetch('/api/config').then(r=>r.json()).then(d => { configData = d; renderConfig(d); renderIntegrations(d); });
  fetch('/api/self').then(r=>r.json()).then(d => { selfData = d; renderSelf(d); });

  let reconnectDelay = 1000;
  function connectSSE() {
    const es = new EventSource('/events');
    es.onopen = () => {
      reconnectDelay = 1000;
      $('conn-dot').classList.add('connected');
      $('top-conn').classList.add('connected');
      $('hdr-status').textContent = 'ONLINE';
    };
    es.onmessage = (evt) => {
      try { renderSnapshot(JSON.parse(evt.data)); } catch(e) {}
    };
    es.onerror = () => {
      es.close();
      $('conn-dot').classList.remove('connected');
      $('top-conn').classList.remove('connected');
      $('hdr-status').textContent = 'RECONNECTING';
      setTimeout(connectSSE, reconnectDelay);
      reconnectDelay = Math.min(reconnectDelay * 1.5, 15000);
    };
  }
  connectSSE();

  // ── Render snapshot ──
  function renderSnapshot(snap) {
    renderSystem(snap.system);
    renderJobs(snap.jobs);
    renderAutomations(snap.automations);
    renderLife(snap.life);
    lastMemories = snap.memories || [];
    if (activeMemTab === 'episodic') renderMemories(lastMemories);
    else renderKnowledge(snap.knowledge || []);
    lastKnowledge = snap.knowledge || [];
    renderJournal(snap.journal);
    renderEvolution(snap.evolution);
    renderLessons(snap.evolution?.lessons || []);
    renderConversations(snap.conversations);
    renderCharacter(snap.character);
    lastSharesData = snap.shares || { pending: [], shared: [], todayCount: 0 };
    renderShares(lastSharesData);
    renderCapabilities(snap.capabilities);
    renderIdeas(snap.life?.ideas || []);
    renderLogs(snap.logs);
    renderTicker(snap.logs);
    updateRightBar(snap);
    updatePulse(snap);
  }

  // ── Hero pulse live stats ──
  function updatePulse(snap) {
    // Brain model
    const pBrain = $('pulse-brain');
    if (pBrain && configData) {
      const model = configData.brain?.model || '--';
      pBrain.textContent = model.length > 16 ? model.slice(0, 14) + '..' : model;
      pBrain.className = 'pulse-val active';
    }
    // Current life activity
    const pAct = $('pulse-activity');
    if (pAct) {
      const life = snap.life;
      if (life && life.paused) { pAct.textContent = 'PAUSED'; pAct.className = 'pulse-val warn'; }
      else if (life && life.status === 'active') { pAct.textContent = (life.lastActivity || 'ACTIVE').toUpperCase(); pAct.className = 'pulse-val active'; }
      else { pAct.textContent = 'IDLE'; pAct.className = 'pulse-val idle'; }
    }
    // Jobs
    const pJobs = $('pulse-jobs');
    if (pJobs) {
      const jobs = snap.jobs || [];
      const running = jobs.filter(j => j.status === 'running').length;
      pJobs.textContent = running > 0 ? running + ' RUN' : jobs.length > 0 ? jobs.length + ' TOTAL' : '0';
      pJobs.className = 'pulse-val' + (running > 0 ? ' active' : ' idle');
    }
  }

  // ── Right bar quick stats ──
  function updateRightBar(snap) {
    // Jobs
    const jobs = snap.jobs || [];
    const running = jobs.filter(j => j.status === 'running').length;
    const rbJobs = $('rb-jobs');
    if (rbJobs) { rbJobs.textContent = running; rbJobs.className = 'r-val' + (running > 0 ? '' : ' zero'); }
    const rbTotal = $('rb-total-jobs');
    if (rbTotal) { rbTotal.textContent = jobs.length; rbTotal.className = 'r-val' + (jobs.length > 0 ? '' : ' zero'); }

    // Life
    const lifeDot = $('rb-life-dot');
    if (lifeDot) {
      const isActive = snap.life && !snap.life.paused && snap.life.status === 'active';
      const isPaused = snap.life && snap.life.paused;
      lifeDot.className = 'r-dot ' + (isActive ? 'on' : isPaused ? 'paused' : 'off');
    }
    const rbActs = $('rb-activities');
    if (rbActs) { const total = snap.life?.totalActivities || 0; rbActs.textContent = total; rbActs.className = 'r-val' + (total > 0 ? '' : ' zero'); }

    // Memories
    const rbMem = $('rb-mem');
    if (rbMem) { const c = (snap.memories || []).length; rbMem.textContent = c; rbMem.className = 'r-val' + (c > 0 ? '' : ' zero'); }

    // Shares
    const rbShares = $('rb-shares');
    if (rbShares) { const c = snap.shares?.pending?.length || 0; rbShares.textContent = c; rbShares.className = 'r-val' + (c > 0 ? '' : ' zero'); }

    // Evolution
    const rbEvo = $('rb-evo');
    if (rbEvo) { const c = snap.evolution?.stats?.totalProposals || 0; rbEvo.textContent = c; rbEvo.className = 'r-val' + (c > 0 ? '' : ' zero'); }

    // Conversations
    const rbConvs = $('rb-convs');
    if (rbConvs) { const c = (snap.conversations || []).length; rbConvs.textContent = c; rbConvs.className = 'r-val' + (c > 0 ? '' : ' zero'); }
  }

  function renderSystem(sys) {
    if (!sys) return;
    $('hdr-uptime').textContent = formatDuration(sys.uptime);
    $('hdr-pid').textContent = sys.pid;
    $('hdr-node').textContent = sys.nodeVersion;

    const cores = sys.cpu.cores;
    const cpu1 = sys.cpu.load1 / cores * 100;
    const cpu5 = sys.cpu.load5 / cores * 100;
    const ramPct = parseFloat(sys.ram.percent);
    const heapPct = sys.process.heapTotal > 0 ? (sys.process.heap / sys.process.heapTotal * 100) : 0;

    setGauge('g-cpu1', cpu1, sys.cpu.load1.toFixed(2) + '/' + cores);
    setGauge('g-cpu5', cpu5, sys.cpu.load5.toFixed(2) + '/' + cores);
    setGauge('g-ram', ramPct, formatBytes(sys.ram.used));
    setGauge('g-heap', heapPct, formatBytes(sys.process.heap));
    setMiniGauge('sb-cpu', cpu1);
    setMiniGauge('sb-ram', ramPct);

    // Hero pulse stats
    const pCpu = $('pulse-cpu');
    if (pCpu) { pCpu.textContent = cpu1.toFixed(0) + '%'; pCpu.className = 'pulse-val' + (cpu1 >= 80 ? ' warn' : cpu1 > 0 ? ' active' : ' idle'); }
    const pHeap = $('pulse-heap');
    if (pHeap) { pHeap.textContent = formatBytes(sys.process.heap); pHeap.className = 'pulse-val' + (heapPct >= 80 ? ' warn' : ' active'); }
    const pUp = $('pulse-uptime');
    if (pUp) { pUp.textContent = formatDuration(sys.uptime); pUp.className = 'pulse-val active'; }
  }

  function renderConfig(cfg) {
    if (!cfg) return;
    let h = '';
    h += `<div class="row"><span class="k">Orch Provider</span><span class="v">${esc(cfg.orchestrator.provider)}</span></div>`;
    h += `<div class="row"><span class="k">Orch Model</span><span class="v">${esc(cfg.orchestrator.model)}</span></div>`;
    h += `<div class="row"><span class="k">Orch Key</span><span class="v">${esc(cfg.orchestrator.api_key)}</span></div>`;
    h += `<div class="row"><span class="k">Brain Provider</span><span class="v">${esc(cfg.brain.provider)}</span></div>`;
    h += `<div class="row"><span class="k">Brain Model</span><span class="v">${esc(cfg.brain.model)}</span></div>`;
    h += `<div class="row"><span class="k">Brain Key</span><span class="v">${esc(cfg.brain.api_key)}</span></div>`;
    h += `<div class="row"><span class="k">Max Tool Depth</span><span class="v">${cfg.brain.max_tool_depth || '--'}</span></div>`;
    if (cfg.swarm) {
      h += `<div class="row"><span class="k">Max Jobs</span><span class="v">${cfg.swarm.max_concurrent_jobs || '--'}</span></div>`;
      h += `<div class="row"><span class="k">Job Timeout</span><span class="v">${cfg.swarm.job_timeout_seconds || '--'}s</span></div>`;
    }
    if (cfg.claude_code) {
      h += `<div class="row"><span class="k">Claude Code</span><span class="v">${esc(cfg.claude_code.model)}</span></div>`;
      h += `<div class="row"><span class="k">CC Auth</span><span class="v">${esc(cfg.claude_code.auth_mode)}</span></div>`;
      h += `<div class="row"><span class="k">CC Max Turns</span><span class="v">${cfg.claude_code.max_turns || '--'}</span></div>`;
    }
    if (cfg.life) {
      h += `<div class="row"><span class="k">Life</span><span class="v">${cfg.life.enabled ? 'ENABLED' : 'DISABLED'}</span></div>`;
      if (cfg.life.self_coding) h += `<div class="row"><span class="k">Self-Coding</span><span class="v">${cfg.life.self_coding.enabled ? 'ON' : 'OFF'}</span></div>`;
    }
    h += `<div class="row"><span class="k">Allowed Users</span><span class="v">${cfg.telegram.allowed_users}</span></div>`;
    $('config-body').innerHTML = h;
  }

  function renderIntegrations(cfg) {
    if (!cfg || !cfg.integrations) return;
    const items = [
      { key: 'telegram', label: 'TELEGRAM' },
      { key: 'github', label: 'GITHUB' },
      { key: 'claude_code', label: 'CLAUDE' },
      { key: 'linkedin', label: 'LINKEDIN' },
      { key: 'x', label: 'X' },
      { key: 'jira', label: 'JIRA' },
      { key: 'elevenlabs', label: '11LABS' },
    ];
    let h = '';
    for (const item of items) {
      const on = cfg.integrations[item.key];
      h += `<div class="integ-item"><span class="integ-dot ${on ? 'on' : 'off'}"></span>${item.label}</div>`;
    }
    $('integrations-bar').innerHTML = h;
  }

  function renderJobs(jobs) {
    if (!jobs || !jobs.length) { $('jobs-body').innerHTML = '<div class="empty-msg">NO JOBS</div>'; updateJobsTag(0, 0); return; }
    const order = { running: 0, queued: 1, completed: 2, failed: 3, cancelled: 4 };
    const sorted = [...jobs].sort((a, b) => (order[a.status] ?? 9) - (order[b.status] ?? 9) || (b.createdAt || 0) - (a.createdAt || 0));
    const running = sorted.filter(j => j.status === 'running').length;
    updateJobsTag(sorted.length, running);
    let h = '';
    for (const j of sorted) {
      h += `<div class="job-row" onclick="this.querySelector('.job-detail')?.classList.toggle('open')">`;
      h += `<div class="job-meta"><span class="job-id">${esc(j.id)}</span><span class="job-type">${esc(j.type)}</span><span class="badge ${j.status}">${j.status.toUpperCase()}</span><span style="color:var(--dim)">${formatDuration(j.duration)}</span><span style="color:var(--dim)">LLM:${j.llmCalls||0} T:${j.toolCalls||0}</span></div>`;
      h += `<div class="job-task">${esc((j.task||'').slice(0,120))}</div>`;
      if (j.status === 'running' && j.lastThinking) h += `<div class="job-sub">${esc(j.lastThinking.slice(0,100))}</div>`;
      if (j.status === 'running' && j.progress?.length) h += `<div class="job-sub">${esc(j.progress[j.progress.length-1])}</div>`;
      if (j.status === 'completed' && j.completedAt) h += `<div class="job-sub">Completed ${timeAgo(j.completedAt)}</div>`;
      if (j.status === 'failed') h += `<div class="job-sub" style="color:var(--red)">Failed ${timeAgo(j.completedAt)}</div>`;
      if (j.status === 'cancelled') h += `<div class="job-sub" style="color:var(--amber)">Cancelled ${timeAgo(j.completedAt)}</div>`;
      // Expandable detail section
      h += '<div class="job-detail">';
      if (j.error) h += `<div class="job-detail-section"><div class="job-detail-label">ERROR</div><div class="job-detail-val error">${esc(j.error)}</div></div>`;
      if (j.context) h += `<div class="job-detail-section"><div class="job-detail-label">CONTEXT</div><div class="job-detail-val">${esc(j.context.slice(0,300))}</div></div>`;
      if (j.dependsOn?.length) h += `<div class="job-detail-section"><div class="job-detail-label">DEPENDS ON</div><div class="job-detail-val">${j.dependsOn.map(d => `<span class="tool-tag">${esc(d)}</span>`).join('')}</div></div>`;
      if (j.timeoutMs) h += `<div class="job-detail-section"><div class="job-detail-label">TIMEOUT</div><div class="job-detail-val">${formatDuration(j.timeoutMs/1000)}</div></div>`;
      if (j.structuredResult) {
        const sr = j.structuredResult;
        if (sr.summary) h += `<div class="job-detail-section"><div class="job-detail-label">SUMMARY</div><div class="job-detail-val">${esc(sr.summary)}</div></div>`;
        if (sr.details) h += `<div class="job-detail-section"><div class="job-detail-label">DETAILS</div><div class="job-detail-val">${esc(sr.details.slice(0,500))}</div></div>`;
        if (sr.toolsUsed?.length) h += `<div class="job-detail-section"><div class="job-detail-label">TOOLS USED</div><div class="job-detail-val">${sr.toolsUsed.map(t => `<span class="tool-tag">${esc(t)}</span>`).join('')}</div></div>`;
        if (sr.artifacts?.length) h += `<div class="job-detail-section"><div class="job-detail-label">ARTIFACTS</div><div class="job-detail-val">${sr.artifacts.map(a => `<span class="artifact-tag">${esc(typeof a === 'string' ? a : JSON.stringify(a).slice(0,60))}</span>`).join('')}</div></div>`;
        if (sr.errors?.length) h += `<div class="job-detail-section"><div class="job-detail-label">ERRORS</div><div class="job-detail-val error">${sr.errors.map(e => esc(e)).join('<br>')}</div></div>`;
        if (sr.followUp) h += `<div class="job-detail-section"><div class="job-detail-label">FOLLOW-UP</div><div class="job-detail-val">${esc(sr.followUp)}</div></div>`;
      }
      if (j.progress?.length > 1) {
        h += `<div class="job-detail-section"><div class="job-detail-label">PROGRESS (${j.progress.length})</div><div class="job-progress-timeline">`;
        for (const p of j.progress) h += `<div>${esc(p)}</div>`;
        h += '</div></div>';
      }
      h += '</div></div>';
    }
    $('jobs-body').innerHTML = h;
  }
  function updateJobsTag(total, running) {
    const tag = $('jobs-count-tag');
    if (tag) tag.textContent = 'SWARM // ' + total + (running > 0 ? ' (' + running + ' ACTIVE)' : '');
  }

  function renderAutomations(autos) {
    if (!autos || !autos.length) { $('auto-body').innerHTML = '<div class="empty-msg">NO AUTOMATIONS</div>'; return; }
    let h = '';
    for (const a of autos) {
      const st = a.enabled ? '<span style="color:var(--accent)">ON</span>' : '<span style="color:var(--amber)">OFF</span>';
      const sched = a.schedule ? (a.schedule.expression || a.schedule.type + (a.schedule.minutes ? ' ' + a.schedule.minutes + 'm' : '')) : '--';
      h += `<div class="auto-item"><div><span class="auto-name">${esc(a.name)}</span> ${st}</div><div class="auto-detail">Sched: ${esc(sched)} | Runs: ${a.runCount}</div>`;
      if (a.lastError) h += `<div class="auto-detail" style="color:var(--red)">ERR: ${esc(a.lastError.slice(0,60))}</div>`;
      h += '</div>';
    }
    $('auto-body').innerHTML = h;
  }

  function renderLife(life) {
    if (!life || life.status === 'unknown') { $('life-body').innerHTML = '<div class="empty-msg">UNAVAILABLE</div>'; return; }
    let h = '';
    const sc = life.paused ? 'paused' : (life.status === 'active' ? 'active' : 'idle');
    h += `<div class="life-status ${sc}">${(life.paused ? 'PAUSED' : life.status || 'IDLE').toUpperCase()}</div>`;
    h += `<div class="row"><span class="k">Total Activities</span><span class="v">${life.totalActivities || 0}</span></div>`;
    h += `<div class="row"><span class="k">Last Activity</span><span class="v">${esc(life.lastActivity || 'none')} (${esc(life.lastActivityAgo || 'never')})</span></div>`;
    h += `<div class="row"><span class="k">Wake-Up</span><span class="v">${esc(life.lastWakeUpAgo || 'never')}</span></div>`;
    if (life.activityCounts) {
      const counts = life.activityCounts;
      const max = Math.max(1, ...Object.values(counts));
      h += '<div style="margin-top:6px">';
      for (const [n, c] of Object.entries(counts)) {
        h += `<div class="activity-bar"><span class="name">${esc(n)}</span><span class="bar"><span class="fill" style="width:${(c/max*100).toFixed(0)}%"></span></span><span class="count">${c}</span></div>`;
      }
      h += '</div>';
    }
    // Cooldowns
    if (life.cooldowns) {
      h += '<div style="margin-top:8px;border-top:1px solid rgba(57,255,20,0.05);padding-top:6px">';
      h += '<div style="font-family:var(--font-hud);font-size:7px;letter-spacing:1.5px;color:var(--dim);margin-bottom:4px">COOLDOWNS</div>';
      const cdNames = { journal: 'JOURNAL', self_code: 'SELF CODE', code_review: 'CODE REV', reflect: 'REFLECT' };
      const cdMaxMs = { journal: 4*3600000, self_code: 2*3600000, code_review: 4*3600000, reflect: 4*3600000 };
      for (const [key, label] of Object.entries(cdNames)) {
        const ms = life.cooldowns[key] || 0;
        const maxMs = cdMaxMs[key];
        const pct = ms > 0 ? (ms / maxMs * 100) : 0;
        const ready = ms <= 0;
        const timeStr = ready ? 'READY' : formatDuration(Math.ceil(ms / 1000));
        h += `<div class="cooldown-row"><span class="cooldown-label">${label}</span><div class="cooldown-bar-track"><div class="cooldown-fill${ready ? ' ready' : ''}" style="width:${ready ? 100 : 100 - pct}%"></div></div><span class="cooldown-time">${timeStr}</span></div>`;
      }
      h += '</div>';
    }
    $('life-body').innerHTML = h;
  }

  function renderEvolution(evo) {
    if (!evo) { $('evo-body').innerHTML = '<div class="empty-msg">NO DATA</div>'; return; }
    let h = '';
    if (evo.stats) {
      const s = evo.stats;
      const total = (s.merged||0) + (s.rejected||0) + (s.failed||0);
      const rate = s.successRate || 0;
      // Ring chart
      const circ = 2 * Math.PI * 30;
      const merged = total > 0 ? (s.merged||0)/total*circ : 0;
      const rejected = total > 0 ? (s.rejected||0)/total*circ : 0;
      const failed = total > 0 ? (s.failed||0)/total*circ : 0;
      h += '<div class="evo-ring-row">';
      h += '<div class="evo-ring"><svg viewBox="0 0 80 80"><circle class="track" cx="40" cy="40" r="30"/>';
      if (total > 0) {
        h += `<circle cx="40" cy="40" r="30" fill="none" stroke="#39ff14" stroke-width="6" stroke-dasharray="${merged} ${circ-merged}" stroke-dashoffset="0"/>`;
        h += `<circle cx="40" cy="40" r="30" fill="none" stroke="#ffb000" stroke-width="6" stroke-dasharray="${rejected} ${circ-rejected}" stroke-dashoffset="${-merged}"/>`;
        h += `<circle cx="40" cy="40" r="30" fill="none" stroke="#ff3333" stroke-width="6" stroke-dasharray="${failed} ${circ-failed}" stroke-dashoffset="${-(merged+rejected)}"/>`;
      }
      h += '</svg><div class="evo-ring-center"><span class="pct">' + rate.toFixed(0) + '%</span><span class="lbl">SUCCESS</span></div></div>';
      h += '<div class="evo-legend">';
      h += `<div class="evo-legend-item"><span class="evo-legend-dot" style="background:#39ff14"></span>${s.merged||0} Merged</div>`;
      h += `<div class="evo-legend-item"><span class="evo-legend-dot" style="background:#ffb000"></span>${s.rejected||0} Rejected</div>`;
      h += `<div class="evo-legend-item"><span class="evo-legend-dot" style="background:#ff3333"></span>${s.failed||0} Failed</div>`;
      h += `<div class="evo-legend-item" style="color:var(--text-bright);margin-top:2px">${s.totalProposals||0} Total</div>`;
      h += '</div></div>';
    }
    if (evo.active) {
      const a = evo.active;
      h += `<div class="evo-proposal" style="border-left:2px solid var(--accent);padding-left:6px"><div style="color:var(--accent);font-family:var(--font-hud);font-size:9px;letter-spacing:1px">ACTIVE: ${esc(a.status)}</div><div style="color:var(--text);font-size:11px">${esc(a.trigger||'')}</div>`;
      if (a.branch) h += `<div style="color:var(--amber);font-size:10px">Branch: ${esc(a.branch)}</div>`;
      h += '</div>';
    }
    if (evo.recent?.length) {
      for (const p of evo.recent) {
        h += `<div class="evo-proposal"><span class="badge ${p.status==='merged'?'completed':p.status==='failed'?'failed':p.status==='rejected'?'cancelled':'queued'}">${esc(p.status)}</span> <span style="color:var(--text);font-size:11px">${esc((p.trigger||'').slice(0,50))}</span> <span style="color:var(--dim);font-size:9px">${timeAgo(p.createdAt)}</span></div>`;
      }
    }
    if (!evo.stats?.totalProposals && !evo.active && !evo.recent?.length) h = '<div class="empty-msg">NO DATA</div>';
    $('evo-body').innerHTML = h;
  }

  function renderMemories(mems) {
    if (!mems || !mems.length) { $('mem-body').innerHTML = '<div class="empty-msg">NO MEMORIES</div>'; return; }
    let h = '';
    for (const m of mems) {
      const imp = m.importance || 0;
      const impCls = imp >= 7 ? 'high' : '';
      h += `<div class="mem-item"><span class="mem-time">${timeAgo(m.timestamp)}</span> <span class="mem-type ${esc(m.type||'interaction')}">${esc((m.type||'').toUpperCase())}</span>`;
      if (imp > 0) h += `<span class="mem-importance ${impCls}">IMP:${imp}</span>`;
      h += `<div class="mem-summary">${esc((m.summary||'').slice(0,120))}</div>`;
      if (m.tags?.length) {
        h += '<div class="mem-tags">';
        for (const t of m.tags.slice(0, 5)) h += `<span class="mem-tag">${esc(t)}</span>`;
        h += '</div>';
      }
      h += '</div>';
    }
    $('mem-body').innerHTML = h;
  }

  function renderJournal(j) {
    if (!j) { $('journal-body').innerHTML = '<div class="empty-msg">NO JOURNAL DATA</div>'; return; }
    // Build date tabs
    const tabsEl = $('journal-tabs');
    if (tabsEl && j.dates?.length) {
      let th = `<span class="panel-tab ${activeJournalDate === 'today' ? 'active' : ''}" data-tab="today">TODAY</span>`;
      for (const d of j.dates.slice(0, 6)) {
        if (d === j.dates[0] && activeJournalDate === 'today') continue; // today is already shown
        const short = d.slice(5); // MM-DD
        th += `<span class="panel-tab ${activeJournalDate === d ? 'active' : ''}" data-tab="${esc(d)}">${short}</span>`;
      }
      tabsEl.innerHTML = th;
    }
    const tag = $('journal-tag');
    if (tag) tag.textContent = activeJournalDate === 'today' ? 'TODAY' : activeJournalDate;
    const content = activeJournalDate === 'today' ? j.content : (j.recent?.find(r => r.date === activeJournalDate)?.content);
    if (!content) { $('journal-body').innerHTML = '<div class="empty-msg">NO ENTRY</div>'; return; }
    const escaped = esc(content).replace(/(\d{1,2}:\d{2}(?::\d{2})?(?:\s*(?:AM|PM))?)/gi, '<span class="ts-line">$1</span>');
    $('journal-body').innerHTML = `<div class="md-content">${escaped}</div>`;
  }

  function renderShares(data) {
    if (!data) { $('shares-body').innerHTML = '<div class="empty-msg">NO SHARES</div>'; return; }
    const tag = $('shares-tag');
    if (tag) tag.textContent = `OUTBOUND // ${data.todayCount || 0} TODAY`;
    const list = activeShareTab === 'pending' ? (data.pending || []) : (data.shared || []);
    if (!list.length) { $('shares-body').innerHTML = `<div class="empty-msg">${activeShareTab === 'pending' ? 'NO PENDING SHARES' : 'NO HISTORY'}</div>`; return; }
    let h = '';
    for (const s of list) {
      const cls = activeShareTab === 'shared' ? 'share-item share-shared' : 'share-item';
      h += `<div class="${cls}"><span class="share-pri ${esc(s.priority||'low')}">[${(s.priority||'low').toUpperCase()}]</span> <span style="color:var(--dim);font-size:9px">${esc(s.source||'')} · ${timeAgo(s.createdAt)}</span><div style="color:var(--text);font-size:11px">${esc((s.content||'').slice(0,100))}</div></div>`;
    }
    $('shares-body').innerHTML = h;
  }

  function renderCharacter(ch) {
    if (!ch) { $('char-body').innerHTML = '<div class="empty-msg">NO DATA</div>'; return; }
    let h = '';
    if (ch.active) {
      h += `<div class="char-active">${esc(ch.active.emoji||'')} ${esc(ch.active.name)}</div>`;
      if (ch.active.tagline) h += `<div style="color:var(--text);font-size:11px;margin-bottom:4px;font-style:italic">${esc(ch.active.tagline)}</div>`;
    }
    if (ch.origin) h += `<div class="row"><span class="k">Origin</span><span class="v">${esc(ch.origin)}</span></div>`;
    if (ch.age) h += `<div class="row"><span class="k">Age</span><span class="v">${esc(ch.age)}</span></div>`;
    if (ch.lastActiveAt) h += `<div class="row"><span class="k">Last Active</span><span class="v">${timeAgo(ch.lastActiveAt)}</span></div>`;
    if (ch.characters?.length) {
      h += '<div style="margin-top:4px;border-top:1px solid rgba(57,255,20,0.05);padding-top:4px">';
      for (const c of ch.characters) {
        const a = ch.active && c.id === ch.active.id;
        h += `<div class="char-item ${a?'active':''}">${esc(c.emoji||'')} ${esc(c.name)}</div>`;
      }
      h += '</div>';
    }
    $('char-body').innerHTML = h;
  }

  function renderConversations(convs) {
    if (!convs || !convs.length) { $('conv-body').innerHTML = '<div class="empty-msg">NONE</div>'; return; }
    let h = '';
    for (const c of convs) {
      h += `<div class="conv-item"><span class="chat-id ${c.chatId==='__life__'?'life':''}">${esc(c.chatId)}</span><span style="color:var(--dim)">${c.messageCount} msgs · ${timeAgo(c.lastTimestamp)}</span></div>`;
      if (c.userMessages || c.assistantMessages) {
        h += `<div style="font-size:9px;color:var(--dim);padding-left:4px">USR:${c.userMessages||0} BOT:${c.assistantMessages||0}`;
        if (c.activeSkill) h += ` <span style="color:var(--magenta)">SKILL:${esc(c.activeSkill)}</span>`;
        h += '</div>';
      }
    }
    $('conv-body').innerHTML = h;
  }

  function renderSelf(s) {
    if (!s || !s.content) {
      $('self-body').innerHTML = '<div class="empty-msg">NO DATA</div>';
      $('self-goals-body').innerHTML = '<div class="empty-msg">NO DATA</div>';
      return;
    }
    // Split content into sections — goals go to separate panel
    const lines = s.content.split('\n');
    let awareness = [], goals = [], inGoals = false;
    for (const line of lines) {
      if (/^#+\s*(goals|aspirations|objectives)/i.test(line)) { inGoals = true; goals.push(line); continue; }
      if (inGoals && /^#+\s/.test(line) && !/goals|aspirations|objectives/i.test(line)) { inGoals = false; }
      if (inGoals) goals.push(line); else awareness.push(line);
    }
    $('self-body').innerHTML = `<div class="md-content">${esc(awareness.join('\n') || s.content)}</div>`;
    $('self-goals-body').innerHTML = goals.length ? `<div class="md-content">${esc(goals.join('\n'))}</div>` : '<div class="empty-msg">NO GOALS DEFINED</div>';
  }

  function renderCapabilities(caps) {
    if (!caps || !caps.workers) { $('caps-body').innerHTML = '<div class="empty-msg">NO DATA</div>'; return; }
    const tag = $('caps-tag');
    if (tag) tag.textContent = `WORKERS // ${caps.totalTools || 0} TOOLS`;
    let h = '<div class="worker-grid">';
    const workerList = Array.isArray(caps.workers) ? caps.workers : Object.values(caps.workers);
    for (const w of workerList) {
      h += '<div class="worker-card">';
      h += `<div class="worker-card-head"><span class="worker-emoji">${esc(w.emoji)}</span><span class="worker-name">${esc(w.label)}</span></div>`;
      h += `<div class="worker-desc">${esc(w.description)}</div>`;
      h += `<div class="worker-meta"><span>Tools: <span class="v">${w.tools?.length || 0}</span></span><span>Timeout: <span class="v">${formatDuration(w.timeout)}</span></span></div>`;
      if (w.tools?.length) {
        h += '<div style="margin-top:3px">';
        for (const t of w.tools.slice(0, 8)) h += `<span class="tool-tag" style="font-size:8px">${esc(t)}</span>`;
        if (w.tools.length > 8) h += `<span style="color:var(--dim);font-size:8px">+${w.tools.length - 8}</span>`;
        h += '</div>';
      }
      h += '</div>';
    }
    h += '</div>';
    $('caps-body').innerHTML = h;
  }

  function renderKnowledge(topics) {
    if (!topics || !topics.length) { $('mem-body').innerHTML = '<div class="empty-msg">NO KNOWLEDGE</div>'; return; }
    const tag = $('mem-tag');
    if (tag) tag.textContent = 'SEMANTIC';
    let h = '';
    for (const t of topics) {
      h += '<div class="knowledge-item">';
      h += `<span class="knowledge-topic">${esc(t.topic)}</span>`;
      if (t.sources?.length) h += ` <span style="color:var(--dim);font-size:8px">${t.sources.length} sources</span>`;
      if (t.summary) h += `<div class="knowledge-summary">${esc(t.summary.slice(0, 120))}</div>`;
      if (t.relatedTopics?.length) h += `<div class="knowledge-related">Related: ${t.relatedTopics.slice(0, 4).map(r => esc(r)).join(', ')}</div>`;
      if (t.learnedAt) h += `<div style="font-size:8px;color:var(--dim)">${timeAgo(new Date(t.learnedAt).getTime())}</div>`;
      h += '</div>';
    }
    $('mem-body').innerHTML = h;
  }

  function renderIdeas(ideas) {
    if (!ideas || !ideas.length) { $('ideas-body').innerHTML = '<div class="empty-msg">NO IDEAS</div>'; return; }
    const tag = $('ideas-tag');
    if (tag) tag.textContent = `BRAIN // ${ideas.length}`;
    let h = '';
    for (const idea of ideas) {
      if (typeof idea === 'string') {
        const isImprove = idea.startsWith('IMPROVE:');
        h += `<div class="idea-item">${isImprove ? '<span class="improve-tag">IMPROVE</span>' : ''}${esc(isImprove ? idea.slice(8).trim() : idea)}</div>`;
      } else {
        h += `<div class="idea-item">`;
        if (idea.type) h += `<span class="improve-tag">${esc(idea.type.toUpperCase())}</span>`;
        h += `${esc(idea.text || idea.content || JSON.stringify(idea).slice(0, 80))}`;
        if (idea.timestamp) h += `<span class="idea-time">${timeAgo(idea.timestamp)}</span>`;
        h += '</div>';
      }
    }
    $('ideas-body').innerHTML = h;
  }

  function renderLessons(lessons) {
    if (!lessons || !lessons.length) { $('lessons-body').innerHTML = '<div class="empty-msg">NO LESSONS</div>'; return; }
    const tag = $('lessons-tag');
    if (tag) tag.textContent = `WISDOM // ${lessons.length}`;
    let h = '';
    for (const l of lessons) {
      h += '<div class="lesson-item">';
      if (l.category) h += `<span class="lesson-cat">${esc(l.category.toUpperCase())}</span>`;
      h += `<span class="lesson-text">${esc((l.lesson || l.text || '').slice(0, 120))}</span>`;
      if (l.importance) h += `<span class="lesson-importance">IMP:${l.importance}</span>`;
      h += '</div>';
    }
    $('lessons-body').innerHTML = h;
  }

  // ── Tab click handlers ──
  document.addEventListener('click', (e) => {
    const tab = e.target.closest('.panel-tab');
    if (!tab) return;
    const parent = tab.closest('.panel-tabs');
    if (!parent) return;
    const tabId = parent.id;
    const val = tab.dataset.tab;

    if (tabId === 'mem-tabs') {
      activeMemTab = val;
      parent.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      const memTag = $('mem-tag');
      if (memTag) memTag.textContent = val === 'episodic' ? 'EPISODIC' : 'SEMANTIC';
      if (val === 'episodic') renderMemories(lastMemories);
      else renderKnowledge(lastKnowledge);
    } else if (tabId === 'shares-tabs') {
      activeShareTab = val;
      parent.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      renderShares(lastSharesData);
    } else if (tabId === 'journal-tabs') {
      activeJournalDate = val;
      parent.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
    }
  });

  function renderLogs(logs) {
    if (!logs || !logs.length) { $('logs-body').innerHTML = '<div class="empty-msg">NO LOGS</div>'; return; }
    const body = $('logs-body');
    const atBottom = body.scrollTop + body.clientHeight >= body.scrollHeight - 20;
    let h = '';
    for (const l of logs) {
      const lvl = (l.level||'info').toLowerCase();
      const ts = l.timestamp ? l.timestamp.replace(/^.*T/,'').replace(/\..*$/,'') : '';
      h += `<div class="log-line"><span class="ts">[${esc(ts)}]</span> <span class="lvl-${lvl}">${esc(lvl.toUpperCase().padEnd(5))}</span> <span class="msg">${esc(l.message)}</span></div>`;
    }
    body.innerHTML = h;
    if (atBottom) body.scrollTop = body.scrollHeight;
  }

  // ── Scrolling ticker ──
  function renderTicker(logs) {
    if (!logs || !logs.length) return;
    const last = logs.slice(-20);
    let items = '';
    for (const l of last) {
      const lvl = (l.level||'info').toLowerCase();
      const ts = l.timestamp ? l.timestamp.replace(/^.*T/,'').replace(/\..*$/,'') : '';
      items += `<span class="ticker-item"><span class="ts">[${esc(ts)}]</span> <span class="lvl-${lvl}">${esc(lvl.toUpperCase())}</span> <span class="msg">${esc((l.message||'').slice(0,80))}</span></span>`;
    }
    // Duplicate for seamless loop
    $('ticker-track').innerHTML = items + items;
    const count = last.length;
    document.documentElement.style.setProperty('--ticker-duration', Math.max(count * 4, 30) + 's');
  }

  // ── Circuit grid background (static grid only) ──
  (function() {
    const canvas = $('particle-canvas');
    const ctx = canvas.getContext('2d');
    let w, h;
    const GRID = 50;

    function resize() {
      w = canvas.width = window.innerWidth;
      h = canvas.height = window.innerHeight;
      drawGrid();
    }

    function drawGrid() {
      ctx.clearRect(0, 0, w, h);
      ctx.strokeStyle = 'rgba(57,255,20,0.02)';
      ctx.lineWidth = 0.5;
      for (let x = 0; x <= w; x += GRID) {
        ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, h); ctx.stroke();
      }
      for (let y = 0; y <= h; y += GRID) {
        ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(w, y); ctx.stroke();
      }
    }

    resize();
    window.addEventListener('resize', resize);
  })();

  // ── Multi-layer waveform (EKG-style pulse) ──
  (function() {
    const canvas = $('waveform-canvas');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    let w, h, phase = 0;

    function resize() {
      const parent = canvas.parentElement;
      w = canvas.width = parent.offsetWidth;
      h = canvas.height = parent.offsetHeight;
    }
    resize();
    window.addEventListener('resize', resize);

    const waves = [
      { freq: 0.015, amp: 0.25, speed: 0.02, alpha: 0.5, width: 1.5 },
      { freq: 0.025, amp: 0.15, speed: 0.035, alpha: 0.3, width: 1 },
      { freq: 0.04,  amp: 0.08, speed: 0.05, alpha: 0.15, width: 0.8 },
    ];

    function draw() {
      requestAnimationFrame(draw);
      ctx.clearRect(0, 0, w, h);
      for (const wave of waves) {
        ctx.beginPath();
        ctx.strokeStyle = `rgba(57,255,20,${wave.alpha})`;
        ctx.lineWidth = wave.width;
        for (let x = 0; x < w; x++) {
          const y = h/2 + Math.sin(x * wave.freq + phase * wave.speed * 60) * h * wave.amp
                       + Math.sin(x * wave.freq * 2.3 + phase * wave.speed * 40) * h * wave.amp * 0.4;
          x === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
        }
        ctx.stroke();
      }
      phase += 0.016;
    }
    requestAnimationFrame(draw);
  })();

  // ── Nav active state sync (sidebar + top bar) ──
  document.querySelectorAll('.nav-item').forEach(item => {
    item.addEventListener('click', () => {
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      item.classList.add('active');
      // Sync top bar nav
      const href = item.getAttribute('href');
      document.querySelectorAll('.top-bar-nav-item').forEach(n => n.classList.remove('active'));
      const match = document.querySelector(`.top-bar-nav-item[href="${href}"]`);
      if (match) match.classList.add('active');
    });
  });
  document.querySelectorAll('.top-bar-nav-item').forEach(item => {
    item.addEventListener('click', (e) => {
      e.preventDefault();
      document.querySelectorAll('.top-bar-nav-item').forEach(n => n.classList.remove('active'));
      item.classList.add('active');
      // Sync sidebar nav
      const href = item.getAttribute('href');
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      const match = document.querySelector(`.nav-item[href="${href}"]`);
      if (match) match.classList.add('active');
      // Scroll to section
      const target = document.querySelector(href);
      if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });
  });

})();
</script>
</body>
</html>
